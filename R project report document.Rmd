---
title: "R Project Report"
output: html_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = "C:/Users/ivarnieuwepc/Documents/GitHub/data")
knitr::opts_chunk$set(comment=NA, fig.width=15, fig.height=15, fig.align = "center")
library(reshape)
library(reshape2)
library(dplyr)
library(tidyr)
library(plotly)
library(ineq)
library(ggplot2)
```

### Report storyline

## 1 Problem analysis

### 1 Introduction to poverty
The world has committed itself to intensive targets for reducing poverty by 2030. The goal to reduce poverty and its related side effects are specified in Sustainable Development Goal (SDG) number one of the total seventeen SDG's set up in the 2030 Agenda for Sustainable Development. All seventeen goals and quantitative targets are meant to stimulate action over the next fifteen years in areas of critical importance for humanity and the planet [2]. 

### 1.1 UN Targets

The negative effects of poverty are enormous. Poverty and related effects slow down development within whole countries. Certain groups are disproportionately represented and face additional constraints, such as limited access to resources and capabilities in escaping poverty. These include women, persons with disabilities, children, and indigenous peoples.

- Target 1: By 2030, eradicate extreme poverty for all people everywhere, currently measured as people living on less than $1.25 a day.

- Target 2: By 2030, reduce at least by half the proportion of men, women and children of all ages living in poverty in all its dimensions according to national definitions.

- Target 3: Implement nationally appropriate social protection systems and measures for all, including floors, and by 2030 achieve substantial coverage of the poor and the vulnerable.

- Target 4: By 2030, ensure that all men and women, in particular the poor and the vulnerable, have equal rights to economic resources.

-	Target 5: By 2030, build the resilience of the poor and those in vulnerable situations.

### 1.2 The role of data in battling poverty

To mobilise resources to overcome inequalities between developed and developing countries data is needed. Data is widely used within decision-making and forms the raw material for accountability of policies. Today, in the private sector, analysis of big data is common for example with consumer profiling and personalised services. Similar techniques are being adopted to gain real-time insights into people’s wellbeing and to target aid interventions to vulnerable groups [2]. Sources of data, if applied responsibly, can enable more evidence-based decision-making, hereby contributing to making progress on the Sustainable Development Goals (SDGs) [1].

This is where a problem lies for analysing the poverty problem. Within the World Development Indicators, a lot of data is missing on various indicators on poverty. According to the IEG, reaching the UN targets faces many obstacles, among one of them is the lack of regularly high-quality data. Of the 139 developing countries, 22 have no data for the past three decades, some 30 countries have not had a survey in the past decade, and 20 countries only have had one survey since 2000 [2]. 

What is even more striking, is that one third of these countries are in Sub-Saharan Africa, where poverty is most frequent. Furthermore, from the countries that are reporting new surveys, eighty percent are from middle-income economies or higher. Also, additions to the survey database have been declining in recent years and the number of surveys within five years of a given date are declining rapidly [2].
 
One of the problems of building and maintaining a usable poverty database are financial, it would cost around 30 million/year to continuously perform surveys in 77 lower income countries. But these costs are not the main problem. There is also an enormous lack of political will within the government to proper store poverty data. Political will covers a multitude of obstacles from a refusal to collect data to unwillingness to release data for analysis. Also, many surveys on poverty known to World Bank staff are not available to other analysts or even to the citizens of the country [3].

### 1.3 Goal of this report

The success of the Sustainable Development Goals will be judged on what the data is telling us about their current state. For SDG 1, this will be mainly done in achieving the headline indicator of extreme poverty reduction, which is the share the population in a country living under the extreme poverty line of 1.90 a day. Without better poverty data, collected more frequently, and open to all, we will never know if that goal can be achieved. This can be done by collecting data, but it would take a lot of time to gather all this data and process it. Therefore, the main goal of this report is constructing a predictive model on basis of indicators that are related to poverty. We also try to get it an insight in the current state of poverty around the world the determine if our model is predicting accurate enough. 

### 1.4 Research questions

Our main research question twofold, the main part is about constructing a model that predicts poverty for various countries around the world. Besides that, we try to explore the current state of poverty and the distribution of wealth around the world. 

*Our main research question is:*
*How can we predict the prevalence of extreme poverty within countries based on a MCMC model and what is the development of poverty around the world since 1990?

*To answer this research, several sub questions are defined:*

•	Question 1: How did poverty in both absolute and multi-level develop from 1990 – 2015 within regions and individual countries?
•	Question 2: How is wealth distributed within countries with the highest poverty headcount?
•	Question 3: Which indicators resemble good estimators for our poverty model?
•	Question 4: What are the parameters of our MCMC model to estimate the prevalence of poverty for countries with missing data?
•	Question 5: What is the accuracy of our predictive model?

### 1.5 Methodology 

Within this report, we try to gain more insight behind the data of poverty around the world. First, we will clean and analyse the data by selecting the relevant indicators. By means of critical analysis and interpretation of figures and numbers, we try to find relations in the data to obtain useful indicators for our model. Also, relevant primary research on the topic of poverty will be included to compare our primary research findings.

R-studio is used as a tool to perform the data analysis within this research. R is widely used as a programming language for the visualisation of data. It contains additional packages that are very powerful for data analysis and visualisation purposes. Within our computations in R, several additional packages have been used. For example, Plotly has been used to make our detailed graphics. In Plotly visualisations are displayed in an efficient way and many possibilities to visualize the data are present. We also use several scripts provided within this course to estimate our model. 


Resources
[1] https://www.globalgoals.org/1-no-poverty
[2] https://sdgcompass.org/sdgs/sdg-1
[3] https://ourworldindata.org/extreme-poverty
[4] http://pubdocs.worldbank.org/en/109701443800596288/PRN03Oct2015TwinGoals.pdf
[5] https://opendatawatch.com/blog/ending-poverty-needs-better-data/
[6] http://ieg.worldbankgroup.org/sites/default/files/Data/reports/poverty_focus_cp_1.pdf
[7] 7https://qz.com/africa/1428639/world-banks-measure-of-poverty-is-flawed/
http://www.un.org/en/sections/issues-depth/big-data-sustainable-development/index.html
	
#### Chapter 2

- Data understanding  introduce used databases + data descriptives

1.Initial data collection

Our data comes from World Development Indicators database(http://data.worldbank.org/data-catalog/world-development-indicators). On the website we could download the data, WDIData.csv. We focus on one of the UN Sustainable Development Goals, No Poverty. Data of over 1440 indicators of more than 200 countries and regions from 1960 to 2015 are provided in the WDI dataset, but only some of them are relevant to what we want to discuss about.  

And two problems has encountered when we try to acquire the data.

First, we narrow down the scope of indicators of the following fields that might be related to ‘No poverty’ goal:
1. Poverty headcount and poverty gap:
-Poverty headcount ratio at national poverty lines (% of population)
-Rural poverty headcount ratio at national poverty lines (% of rural population)
-Urban poverty headcount ratio at national poverty lines (% of urban population)
-Poverty headcount ratio at $1.90 a day (2011 PPP) (% of population)
-Poverty headcount ratio at $3.20 a day (2011 PPP) (% of population)
-Poverty headcount ratio at $5.50 a day (2011 PPP) (% of population)
-Poverty gap at $1.90 a day (2011 PPP) (%)
-Poverty gap at $3.20 a day (2011 PPP) (%)
-Poverty gap at $5.50 a day (2011 PPP) (%)
-Poverty gap at national poverty lines (%)
2. Social welfare:
-Coverage of social safety net programs (% of population)
-Coverage of social insurance programs (% of population)
3. Indicators that we decidede to use (life expectation, education,economy)

Secondly, we choose to start our analysis in a world level to have a first sight into the data, and then focus on some certain countries with data in relatively abnormal trend. 

Thirdly, we use the data from 1990 to 2015. The number of people living in extreme poverty dropped by more than half between 1990 and 2015. We want to find out the exact trend of how poverty has changed in the word thought out that period. Further more, we try to quantify the correlation between poverty in certain countries and the social welfare system in those countries to have a basic knowledge on how effective the social programs are. 

Last, we want to predict the missing data on poverty with our regression model using predictors of life expectancy, education, and mortality of infants, and with the data we will get a fuller picture of how the poverty will be reduced in the future.

2.Data Description and quality problem 
We assume that indicators about social safety program, education, life expectation, mortality rate of infants are related to the poverty situation in countries. And we also make the hypothesis that social safety program, education and life expectation have negative correlation with poverty, while mortality rate of infants is positively related to poverty. These indicators include scales of both social science and economy so that we could look into the properties of poverty with a broader scope. 
*Missing part: Quantity of the data:*
But in the indicators we choose, a lot of data is missing. We have two solutions on the missing data. Strategy one is to drop off the data with a lot of missing part. The other way is more…
*What do we do with the missing data:*
For the world map, 

Also, we try to make a multiple regression model based on Baye’s rule using the predictors we choose, again within the predictors there are lot of missing data(i.e. NA in the predictor education). *how many missing data are there*
To deal with the problem, …
- Data preparation  how did we modify the data to properly use it 
1.Loading, choosing data we need and merging
Here we make a list of name of data in the fields that we are interested in, merge them in to one single longer list and make a subset of the data we want.

```{r}
# Read the data in correctly
mydata_utf8 = read.table("WDI/WDIData.csv",sep=",",fileEncoding="UTF-8-BOM",header=TRUE)  

# drop off the final blank column
mydata = mydata_utf8[,1:62]

all_code = unique(mydata[,1:2])
all_var = unique(mydata[,3:4])

# use the right countries
#country_code = read.table("data/WDI/country_code.csv",sep=",",header=FALSE)  
# listing all our variables and group them by UN targets or characteristics

Grouping_variables_population = list("SE.XPD.TOTL.GD.ZS","P.DYN.LE00.IN","SI.POV.NAGP","SP.DYN.LE00.IN","SE.XPD.TOTL.GD.ZS","SP.RUR.TOTL.ZS","SP.POP.GROW","SP.POP.TOTL","SP.POP.TOTL.MA.IN","SP.POP.TOTL.FE.IN","SP.URB.TOTL.IN.ZS", "SI.POV.URHC", "SP.RUR.TOTL.ZS", "SI.POV.RUHC", "SI.POV.DDAY", "SP.POP.TOTL")


Target_1_Headcount_Poverty_190_320_550 = list("SI.POV.DDAY","SI.POV.LMIC,SI.POV.UMIC","SI.POV.GAPS","SI.POV.LMIC.GP","SI.POV.UMIC.GP")

Target_2_National_Poverty_Lines_Indicator = list("SI.POV.NAHC","SI.POV.RUHC","SI.POV.URHC","SI.POV.NAGP","SI.POV.RUGP",
                                              "SI.POV.URGP")

Target_3_A_Social_insurance_programm = list("per_si_allsi.cov_pop_tot",
                                         "per_si_allsi.cov_q2_tot",
                                         "per_si_allsi.cov_q3_tot",
                                         "per_si_allsi.cov_q4_tot",
                                         "per_si_allsi.cov_q1_tot",
                                         "per_si_allsi.cov_q5_tot",
                                         "per_allsp.cov_pop_tot")

Target_3_B_Social_Safety_Net_programm = list("per_sa_allsa.cov_pop_tot",
                                          "per_sa_allsa.cov_q2_tot",
                                          "per_sa_allsa.cov_q3_tot",
                                          "per_sa_allsa.cov_q4_tot",
                                          "per_sa_allsa.cov_q1_tot",
                                          "per_sa_allsa.cov_q5_tot")

Target_3_C_Social_Safety_Net_programm = list("per_lm_alllm.cov_pop_tot",
                                          "per_lm_alllm.cov_q2_tot",
                                          "per_lm_alllm.cov_q3_tot",
                                          "per_lm_alllm.cov_q4_tot",
                                          "per_lm_alllm.cov_q1_tot",
                                          "per_lm_alllm.cov_q5_tot")

indicators_income_share = list("SI.DST.04TH.20","SI.DST.10TH.10","SI.DST.05TH.20","SI.DST.FRST.10",
                            "SI.DST.FRST.20","SI.DST.02ND.20","SI.DST.03RD.20")

indicators_economy = list("NY.GNP.PCAP.CD","NY.GNP.MKTP.CN","FP.CPI.TOTL.ZG","NY.GDP.DEFL.KD.ZG","NY.GDP.DEFL.KD.ZG.AD",
                       "TX.VAL.MRCH.CD.WT","TX.VAL.MRCH.WL.CD","TM.VAL.MRCH.CD.WT","TM.VAL.MRCH.WL.CD","SI.POV.GINI")

indicators_life_span = list("SH.DTH.IMRT","SP.DTH.INFR.ZS","SP.DTH.INFR.ZS","SP.DYN.TO65.FE.ZS","SP.DYN.TO65.MA.ZS",
                         "SP.DYN.IMRT.IN","SP.DYN.IMRT.FE.IN","SP.DYN.IMRT.MA.IN")

#putting all indicators names in one list to merge all lists with a loop, see below
List_of_indicators_list = list(indicators_life_span,indicators_economy,indicators_income_share, Target_3_C_Social_Safety_Net_programm,Target_3_B_Social_Safety_Net_programm,Target_3_A_Social_insurance_programm,Target_2_National_Poverty_Lines_Indicator,Target_1_Headcount_Poverty_190_320_550,Grouping_variables_population)

my_vars = list()
for (i in List_of_indicators_list ) {
  my_vars = append(my_vars,i)
}
my_vars_c = c(my_vars)

```

2.Reshaping
But for purpose of easier use, we reshape the data into the format that in each row, there’s one value of an indicator in one country of one year, with the columns of country code, region, country name, indicator code, indicator name, year, and the value. Also we delete the “X” in the name of years.

```{r}
# subset the data - selected var with all years
#country_data = subset(mydata,mydata$Country.Code %in% country_code$V1)
indicator_data = subset(mydata,mydata$Indicator.Code %in% my_vars_c)

# subset the data - selected var with only 1990 - 2015 & prepare data for plotting
indicator_data_1990_2015 = indicator_data[,c(2:3,4:4,35:60)]
colnames(indicator_data_1990_2015) <- sub("X", "", colnames(indicator_data_1990_2015))

our_indicator_data= melt(indicator_data_1990_2015,id=c("Indicator.Code","Indicator.Name","Country.Code"), value.name = "Year")
#setting up indicator data with country names from python @martijn
country_names = read.table("country_names.csv",sep = ",", header = TRUE)
country_wdi = country_names[,c(1:2,5:5)]

colnames(country_wdi) = c("Country.Code","Region","Region/Country Name")
our_indicator_data = merge(country_wdi,our_indicator_data,id = "Country.Code")
colnames(our_indicator_data)=c("Country.Code","Region","Country.Name","Indicator.Code","Indicator.Name","Year","Value")

#Obtaining lists for information about regions and countries
all_region_and_country_codes=our_indicator_data[,1:3]
all_region_and_country_codes=unique(all_region_and_country_codes)
all_regions = subset(all_region_and_country_codes, all_region_and_country_codes$Region == "")
all_countries = subset(all_region_and_country_codes, all_region_and_country_codes$Region != "")

#did a work around because factor levels in R
general_regions = unique(all_countries['Region'])
region_list = c('Latin America & Caribbean','South Asia','Sub-Saharan Africa','Europe & Central Asia','Middle East & North Africa','East Asia & Pacific','North America')

#Subset to extract regions
regions_used = subset(all_regions, all_regions$'Region/Country Name' %in% region_list)
regions_used = regions_used[,-c(2)]
```
Generating used data for Linechart about poverty
```{r}

#CODE FOR THE GINI INDICES
# subset the data - selected var GINI
indicator_datagini = subset(indicator_data,indicator_data$Indicator.Code=="SI.POV.GINI")

# LINE PLOT FOR THE COUNTRIES WITH THE HIGHEST GINI INDEXES
# extract the right years (25:60 is 1980 till 2015)
id = indicator_datagini[,c(2:3,4:4, 25:60)]
# remove the 'X' in the columns
colnames(id) <- sub("X", "", colnames(id))
# change the format
idm = melt(id, id=c("Indicator.Code","Indicator.Name","Country.Code"), value.name = "Year")
# throw away the rows with missing data
idm <- na.omit(idm, cols="value")
```



```{r}
#CODE FOR MAKING THE BUBBLE CHART OF POVERTY AND SPENDINGS ON EDUCATION
#making bubble chart of poverty 3.10 and life expectancy
var_i = c("SE.XPD.TOTL.GD.ZS","SI.POV.DDAY","SP.POP.TOTL")

#subset the data with only the world and the two indicators above about population and people in poverty and life expectancy
bubble_chart_1 = subset(our_indicator_data,our_indicator_data$'Indicator.Code' %in% var_i)
test <- subset(bubble_chart_1, select = c("Indicator.Code","Region", "Country.Name", "Country.Code", "Year", "Value"))
df_bubble = dcast(test,Country.Code + Country.Name + Region + Year ~ Indicator.Code, value.var ="Value")
df_bubble_2013 = df_bubble[which(df_bubble$Year == 2012),]
df_bubble_2013$SP.POP.TOTL = df_bubble_2013$SP.POP.TOTL/1000000
df_bubble_2013$SI.POV.DDAY = df_bubble_2013$SI.POV.DDAY/100
df_bubble_2013$TotalPopPov = df_bubble_2013$SI.POV.DDAY * df_bubble_2013$SP.POP.TOTL

colnames(df_bubble_2013) = c("Country.Code", "Country.Name","Region","Year","EduSpending", "Poverty","TotalPop","TotalPopPov")

#omit NA's
df_bubble_2013_na = na.omit(df_bubble_2013)
#order to omit regions, only hold countries
df_bubble_2013_na = df_bubble_2013_na[order(df_bubble_2013_na$Region, df_bubble_2013_na$Country.Name),]
x = as.numeric(dim(df_bubble_2013_na))
k = x[1]
df_bubble_2013_na_se = df_bubble_2013_na[c(13:k),]
#fix values with to many decimals and poverty percentage value
df_bubble_2013_na_se$Poverty = df_bubble_2013_na_se$Poverty *100
df_bubble_2013_na_se$Poverty = round(df_bubble_2013_na_se$Poverty,2)
df_bubble_2013_na_se$TotalPop = round(df_bubble_2013_na_se$TotalPop,2)
df_bubble_2013_na_se$TotalPopPov = round(df_bubble_2013_na_se$TotalPopPov,2)
df_bubble_2013_na_se$EduSpending = round(df_bubble_2013_na_se$EduSpending,2)

#CODE FOR MAKING THE BUBBLE CHATY OF POVERTY AND LIFE EXPECTANCY
#making bubble chart of poverty 1.90 and life expectancy
var_i = c("SP.DYN.LE00.IN","SI.POV.DDAY","SP.POP.TOTL")

#subset the data with only the world and the two indicators above about population and people in poverty and life expectancy
graph_data = subset(our_indicator_data,our_indicator_data$'Indicator.Code' %in% var_i)
test <- subset(graph_data, select = c("Indicator.Code","Region", "Country.Name", "Country.Code", "Year", "Value"))
df_bubble = dcast(test,Country.Code + Country.Name + Region + Year ~ Indicator.Code, value.var ="Value")
df_bubble_2013 = df_bubble[which(df_bubble$Year == 2012),]
df_bubble_2013$SP.POP.TOTL = df_bubble_2013$SP.POP.TOTL/1000000
df_bubble_2013$SI.POV.DDAY = df_bubble_2013$SI.POV.DDAY/100
df_bubble_2013$TotalPopPov = df_bubble_2013$SI.POV.DDAY * df_bubble_2013$SP.POP.TOTL

colnames(df_bubble_2013) = c("Country.Code", "Country.Name","Region","Year","Poverty","LifeExpec","TotalPop","TotalPopPov")

#omit NA
df_bubble_2013_na = na.omit(df_bubble_2013)
#order to omit regions only hold countries
df_bubble_2013_na = df_bubble_2013_na[order(df_bubble_2013_na$Region, df_bubble_2013_na$Country.Name),]
x = as.numeric(dim(df_bubble_2013_na))
k = x[1]
df_bubble_2013_na = df_bubble_2013_na[c(13:k),]
#fix values with to many decimals and poverty percentage value
df_bubble_2013_na$Poverty = df_bubble_2013_na$Poverty *100
df_bubble_2013_na$Poverty = round(df_bubble_2013_na$Poverty,2)
df_bubble_2013_na$TotalPop = round(df_bubble_2013_na$TotalPop,2)
df_bubble_2013_na$TotalPopPov = round(df_bubble_2013_na$TotalPopPov,2)
df_bubble_2013_na$LifeExpec = round(df_bubble_2013_na$LifeExpec,2)

```

#### Chapter 3 modelling and graphs
-	Define a descriptive model for the relevant data (Visual graphs)
-	Specify a prior distribution
-	Use Bayesian inference to discuss credibility across parameter values
7
First we explore our data, by analysing the data and to 


3 Data analysis
Within chapter 3, we try to answer our research question by means of several sub questions, see section 1.2. This is mainly done by analysing large datasets and trying to visualise this data by means of appropriate graphs. We try to gain more insight in the state of of poverty around the world. 



3.1 The state of poverty in the world
The code below plots the absolute number op people living in poverty (below 1.90$ a day) over the years 1980 till 2015
```{r}
#FOR THE LINECHART ABOUT ABSOLUTE POVERTY
world = c("WLD")
var_i = c("SI.POV.DDAY", "SP.POP.TOTL")
#subset the data with only the world and the two indicators above about population and people in poverty in %
graph_absolute = subset(our_indicator_data,our_indicator_data$'Indicator.Code' %in% var_i)
graph_absolute = subset(graph_absolute,graph_absolute$'Country.Code' %in% world)
graph_absolute = graph_absolute[,c(4:7)]
#split the indicator column into two columns
wide = dcast(graph_absolute,Year ~ Indicator.Code,  value.var = "Value")
#this is a workaround for getting for each year the value for the two indicators into the same row
#omit all na values
wide <- na.omit(wide)

#multiply the data to get the absolute number of people living in poverty
wide$absolute <- (wide$SI.POV.DDAY/100) * (wide$SP.POP.TOTL/(10^9))
wide$absolute = round(wide$absolute,3)

#add hover text
wide$hover = with(wide, paste( "Year:", Year ,
                               "<br> World population living in extreme povert:",absolute,"M",
                               "<br> Share of global population:", SI.POV.DDAY,"%"))
#layout
a <- list(
  title = "Years",
  showticklabels = TRUE,
  gridwidth = 2,
  autotick = F, 
  dtick = 2,
  range = c(0,25),
  showline = T
)
b <- list(
  title = "Number of people living in poverty (1,90$ a day)",
  showticklabels = TRUE,
  gridwidth = 2,
  showline = T
)
#plot the graph
plot_ly(wide, x = ~Year, y = ~absolute, text = ~hover ,type = 'scatter', mode = 'lines') %>% 
  layout(xaxis = a, yaxis = b, title = 'Global population living in extreme poverty 1990 - 2015')
```

``` {r}
knitr::opts_chunk$set(echo = TRUE)

#selecting data from wdi + average of 6 years 2010 - 2015
var_i = c("SI.POV.DDAY","SP.POP.TOTL")
year = c('2010','2011', '2012','2013','2014','2015')

#subset the data with only the world and the two indicators above about population and people in poverty
geo_map_average = subset(our_indicator_data,our_indicator_data$'Indicator.Code' %in% var_i)
geo_map_average = subset(geo_map_average,geo_map_average$Year %in% year)
geo_map_average <- subset(geo_map_average, select = c("Indicator.Code","Country.Name", "Country.Code", "Year", "Value"))

#Calculate average over columns
df_mean_pov = dcast(geo_map_average,Country.Code + Country.Name + Indicator.Code ~ Year, value.var ="Value")
df_mean_pov['mean'] = rowMeans(df_mean_pov[,4:9],na.rm = T)
df_mean_pov = dcast(df_mean_pov,Country.Code + Country.Name  ~ Indicator.Code, value.var ="mean")
colnames(df_mean_pov) = c("Country.Code","Country.Name","MeanHeadCount","MeanPop")

#fix indicator values for plotting and calculate poverty population
df_mean_pov$MeanPop = df_mean_pov$MeanPop/1000000
df_mean_pov['MeanPovPop'] = df_mean_pov[,3]*(df_mean_pov[,4]/100)
df_mean_pov$MeanPop = round(df_mean_pov$MeanPop,2)
df_mean_pov$MeanHeadCount = round(df_mean_pov$MeanHeadCount,2)
df_mean_pov$MeanPovPop = round(df_mean_pov$MeanPovPop,2)

# light grey boundaries
l <- list(color = toRGB("grey"), width = 0.5)

df_mean_pov$hover <- with(df_mean_pov, paste
                                     ( "Year: 2015",'<br>',
                                       "Percentage under extreme poverty line:",MeanHeadCount,"%" ,'<br>',
                                       "Mean population living in extreme poverty:",MeanPovPop,"M",'<br>',
                                       "Total population:",MeanPop,"M",'<br>', 
                                       "Country:", Country.Name))

# specify map projection/options
g <- list(
  resolution = 5,
  showcoastlines = T,
  countrycolor = toRGB("grey"),
  coastlinecolor = toRGB("grey"),
  projection = list(type = 'Mercator'))

k <- plot_geo(df_mean_pov) %>%
  add_trace(z = ~MeanHeadCount,text = ~hover, color = ~MeanHeadCount, colors= 'Reds', 
            locations = ~Country.Code, 
            marker = list(line = l,color = 'rgb(255,255,255)')) %>%
  
  colorbar(title = 'Percentage of total population living extreme poverty') %>%
  layout(title = 'Prevalance of Extreme Poverty during 2010 - 2015 (below 1.90$ a day)',geo = g)
k
```


Plotting the gini indices
Below is the code for plotting the gini indices for the eight countries with the lowest Gini index according to the data from the world map.

```{r}
#What countries have the lowest gini indices?
cl <- c("MDG","BDI","MWI","GNB","MOZ","ZMB","LSO")
# subset with only those countries
idmc <- subset(idm,idm$Country.Code %in% cl)
# plot the gini idexes of those countries over time
x <- list( title = "Years" )
y <- list( title = "Gini Index" )
m <- list(l=150, r=20, b=70, t=10)
pline <- plot_ly(idmc, x = ~idmc$variable, y = ~idmc$value, color = ~idmc$Country.Code) %>%
  add_lines(line = list(shape = "spline"))  %>% layout(xaxis = x, yaxis = y, margin=m)
pline
```

Below is the code for the lorenzcurve of the countrie with the lowest Gini Index. The lorenzcurve shows the distribution of wealth between the people in a country. Every Lorenzcurve has it own gini score. The more away the lorenzcurve is from the middle diagonal, the higher the Gini index and the more unfair the wealth is distributed.ADD COUNTRY NAME IN TITLE

```{r}
# PLOT THE LORENZ CURVE OF ONE OF THE COUNTRIES (if a flat line occurs, there is no data)
# Get the indicators for the lorenz curve
my_var = c( "SI.DST.05TH.20","SI.DST.02ND.20","SI.DST.03RD.20", "SI.DST.04TH.20", "SI.DST.FRST.20")
# fill in country code in V1 and run code below
V1 = c("LSO")
# subset the data with only the country and the needed indicators
country_data = subset(indicator_data,indicator_data$Country.Code %in% V1)
COUNTRY_LC_V1 = subset(country_data,country_data$Indicator.Code %in% my_var)
# slice the needed data for the desirable year
COUNTRY_2015 = COUNTRY_LC_V1[,c(1:4,55:55)]
# create a vector for the lorenz curve function
p20 = c( 20, 40, 60 , 80, 100)
# sort the values of the indicators. Make sure the year is the right one
d20 = sort(COUNTRY_2015$X2010)
# plot the lorenz curve
Lc.c <- Lc(d20, p20)
plot(Lc.c)

gini_index_country = Gini(d20)

```


Below is the code for the bubble between poverty and spendings on education

```{r}
#determine size per bubble
slope <- 2.8e-6
df_bubble_2013_na_se$size <- sqrt(df_bubble_2013_na_se$Poverty * slope)*5000
colors = c('#FF934F','#FFD166','#5FCC8C','#EF6464','#5DCBEF','#8C6ACC','#CC6AAC')

p <- plot_ly(df_bubble_2013_na_se, x = ~EduSpending, y = ~Poverty, color = ~Region, size = ~size, colors = colors,
             type = 'scatter', mode = 'markers', sizes = c(min(df_bubble_2013_na_se$size), max(df_bubble_2013_na_se$size)),
             marker = list(symbol = 'circle', sizemode = 'diameter',
                           line = list(width = 2, color = '#FFFFFF')),
             text = ~paste('Country:', Country.Name,
                           '<br> Region:', Region,
                           '<br>Spending on Education % of GDP:', EduSpending,"%",
                           "<br> Percentage of population living in Extreme Poverty", Poverty,"%",
                           "<br> Total population living in Extreme Poverty:", TotalPopPov,"M",
                           '<br> Total population:', TotalPop, "M")) %>%
  layout(title = 'Public spending on education and the prevalence of Extreme Poverty',
         xaxis = list(title = 'Public spending on education (% of GDP)',
                      gridcolor = 'rgb(255, 255, 255)',
                      zerolinewidth = 1,
                      ticklen = 4,
                      gridwidth = 2),
         yaxis = list(title = 'Prevalence of Poverty (%population)',
                      gridcolor = 'rgb(255, 255, 255)',
                      zerolinewidth = 1,
                      ticklen = 5,
                      gridwith = 2),
         paper_bgcolor = 'rgb(243, 243, 243)',
         plot_bgcolor = 'rgb(243, 243, 243)')
p
```
Code for bubble chart between poverty and life expactancy
```{r}
#determine size per bubble
slope <- 2.8e-6
df_bubble_2013_na$size <- sqrt(df_bubble_2013_na$Poverty * slope)*5000
colors = c('#FF934F','#FFD166','#5FCC8C','#EF6464','#5DCBEF','#8C6ACC','#CC6AAC')
                                            
p <- plot_ly(df_bubble_2013_na, x = ~LifeExpec, y = ~Poverty, color = ~Region, size = ~size, colors = colors,
             type = 'scatter', mode = 'markers', sizes = c(min(df_bubble_2013_na$size), max(df_bubble_2013_na$size)),
             marker = list(symbol = 'circle', sizemode = 'diameter',
                           line = list(width = 2, color = '#FFFFFF')),
             text = ~paste('Country:', Country.Name, '<br> Life expectance by birth', LifeExpec,"years", '<br>Region:', Region,
                           "<br> Percentage of population living in Extreme Poverty", Poverty,"%",
                           "<br> Total population living in Extreme Poverty:", TotalPopPov,"M",
                           '<br> Total population:', TotalPop, "M")) %>%
  layout(title = 'Life Expectancy and Extreme Poverty 2013',
         xaxis = list(title = 'Life expectancy in years (by birth)',
                      gridcolor = 'rgb(255, 255, 255)',
                      zerolinewidth = 1,
                      type = 'log',
                      ticklen = 4,
                      gridwidth = 2),
         yaxis = list(title = 'Prevalence of Poverty (% of population)',
                      gridcolor = 'rgb(255, 255, 255)',
                      zerolinewidth = 1,
                      ticklen = 5,
                      range = c(-15,100),
                      gridwith = 2),
         paper_bgcolor = 'rgb(243, 243, 243)',
         plot_bgcolor = 'rgb(243, 243, 243)')
p

```
code for stacked graph
```{r}
library(ggplot2)

#CODE FOR STACKED GRAPH
poverty_gap_data <- subset(our_indicator_data,our_indicator_data$Indicator.Code=="SI.POV.GAPS")
#remove the rows without any data
poverty_gap_withoutNA <- poverty_gap_data[-which(rowSums(is.na(poverty_gap_data))>0),]
##poverty line $1.90, six regions in one graph
regions_melt <- subset(poverty_gap_withoutNA, Country.Name =="East Asia & Pacific" | Country.Name =="Europe & Central Asia"| Country.Name =="Latin America & Caribbean"| Country.Name =="Middle East & North Africa"| Country.Name =="South Asia"| Country.Name =="Sub-Saharan Africa")


gg <- ggplot(regions_melt, aes(x=Year, y=Value))
gg <- gg + geom_area(aes(fill=Country.Name))

#the color of the stacked area
gg = gg + scale_fill_brewer(palette="Greens", breaks=rev(levels(regions_melt$Country.Name)))
#label name
gg <- gg + labs(x="Year", y="Poverty ratio",col="Regions")
#label of the legend
gg <- gg + guides(fill = guide_legend(title = "Region"))
#remove the background and grid
gg <- gg + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
                              panel.grid.minor = element_blank(), axis.line = element_line(colour ="black"))
gg

```
The code below is for the worldmap

```{r}
#Selecting MDI Data, drop last 3 columns with no values
MPIData = read.table("MPIData.csv",sep=";",header=TRUE)  
colnames(MPIData)[1] <- "CountryCode"
MPIData = MPIData[,1:20]

#Selecting MDI Data, drop last 3 columns with no values
MPIData2016 = read.table("MPIData2016.csv",sep=";",header=TRUE)  
colnames(MPIData2016)[1] <- "PublishYear"

# light grey boundaries
l <- list(color = toRGB("grey"), width = 0.5)

MPIData2016$hover <- with(MPIData2016, paste
                      ( "Year:", SurveyYear,
                            "<br> Country:", Country,
                            "<br> Share of the pop. in Multi Level Poverty: ", Headcount.ratio ,"%",
                            "<br> Multi Poverty Index:", MPI,
                            "<br> Child school attendace:", ChildSchoolAttendance))
                          
# specify map projection/options
g <- list(
  resolution = 5,
  showcoastlines = T,
  countrycolor = toRGB("grey"),
  coastlinecolor = toRGB("grey"),
  projection = list(type = 'Mercator') 
)

k <- plot_geo(MPIData2016) %>%
  add_trace(z = ~Headcount.ratio,text = ~hover, color = ~Headcount.ratio, colors = 'YlGnBu' ,
            locations = ~CountryCode, 
            marker = list(line = l,color = 'rgb(255,255,255)')) %>%
  
  colorbar(title = '/nShare of population living in MPI') %>%
  layout(
    title = 'Share of population per country trapped in multi level poverty',
    geo = g )
k
```
#### Chapter 4 evaluation
- evaluation
-	Discuss research findings to quality of the model, quality of the data. 
-	How could the model be improved  suggest next steps
#### Chapter 5 development
	- Can we predict future behaviour/Guide additional policy
	- How would we communicate our findings to decision makers? 



Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
