---
title: "R Project Report"
output: html_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = "C:/Users/Rob/Documents/GitHub/data")
library(reshape)
library(reshape2)
library(dplyr)
library(tidyr)
library(plotly)
library(ineq)
library(ggplot2)
```

### Report storyline

#### Chapter 1
- Problem understanding = Introduction on poverty
- Research question formulation:

Main question: 
How did poverty develop around the world since 1990 to national and absolute dimension and how is this related to the presence of social safety programs?

To answer this research, several sub questions are defined:

-  Question 1: How did poverty for all develop from 1990 – 2015 for national and absolute dimensions?
	- To national definitions  world map
	- To UN definitions 1.90,350,5,50 -> stacked linechart 
- Question 2: How is wealth distributed for countries with a relatively high poverty headcount to national poverty lines.
	- GINI index and Lorenz curve for pick five worst from national map
- Question 3: What is the effect of social programs on the prevalence of poverty according to national poverty lines?
	- Barchart of absolute and percentage population living under national poverty line
	- Regression with seaborn (python example) x = poverty, y social program
	
## 1 Introduction to poverty
The world has committed itself to intensive targets for reducing poverty by 2030. The goal to reduce poverty and its related side effects are specified in Sustainable Development Goal (SDG) number one of the total seventeen SDG's set up in the 2030 Agenda for Sustainable Development. All seventeen goals and quantive targets are meant to stimulate action over the next fifteen years in areas of critical importance for humanity and the planet [2]. 

The negative effects of povety are enormous. Poverty and related effects slow down development within whole countries. Certain groups are disproportionately represented and face additional constraints, such as limited access to resources and capabilities in escaping poverty. These include women, persons with disabilities, children, and indigenous peoples.

### 1.1 UN Targets

Eradicating poverty is not about charity, it is an act of justice. It could also unlock an enormous human potential that is to present day have been diminisshed. Still, nearly half of the world’s population lives in poverty. To battle poverty, the UN have constructed several quantative targets that need to be reaced by 2030, see below.

Target 1: By 2030, eradicate extreme poverty for all people everywhere, currently measured as people living on less than $1.25 a day.

Target 2: By 2030, reduce at least by half the proportion of men, women and children of all ages living in poverty in all its dimensions according to national definitions.

Target 3: Implement nationally appropriate social protection systems and measures for all, including floors, and by 2030 achieve substantial coverage of the poor and the vulnerable.

Target 4: By 2030, ensure that all men and women, in particular the poor and the vulnerable, have equal rights to economic resources, as well as access to basic services, ownership and control over land and other forms of property, inheritance, natural resources, appropriate new technology and financial services, including microfinance.

Target 5: By 2030, build the resilience of the poor and those in vulnerable situations and reduce their exposure and vulnerability to climate-related extreme events and other economic, social and environmental shocks and disasters.

These targets have been used to draft our research question, see the next paragraph. 

### 1.2 Goal and research questions

Eradicating poverty is not about charity, it is an act of justice. It could also unlock an enormous human potential that is to present day have been diminisshed. Still, nearly half of the world’s population lives in poverty. To obtain more insight in poverty and its underlying relations causes and effects, the folowwing research question have been constructed, see below.

Main research question: 
How did poverty develop around the world since 1990 to national and absolute dimension and how is this related to the presence of social safety programs?

To answer this research, several sub questions are defined:

-  Question 1: How did poverty for all develop from 1990 – 2015 for national and absolute dimensions?
	- To national definitions  world map
	- To UN definitions 1.90,350,5,50 -> stacked linechart 
	- Distribution for men/women/children stacked bar chart for three groups
	
- Question 2: How is wealth distributed for countries with a relatively high poverty headcount to national poverty lines.
	- GINI index and Lorenz curve for pick five worst from national map
	
- Question 3: What is the effect of social programs on the prevalence of poverty according to national poverty lines?
	- Barchart of absolute and percentage population living under national poverty line
	- Regression with seaborn (python example) x = poverty, y social program

### 1.3 Methodology and Research Goal 
Within this report, we try to gain more insight behind the data of poverty around the world. First, we will clean and analyse the data by selecting the relevant indicators. By means of critical analysis and interpretation of figures and numbers, we try to find relations in the data to obtain useful conclusion for our recommendation to policy makers. Also, relevant primary research on the topic of Zero Hunger and food security will be included to compare our primary research findings.

R-studio is used as a tool to perform the data analysis within this research. R is widely used as a programming language for the visualisation of data. It contains additional packages that are very powerful for data analysis and visualisation purposes. Within our computations in R, several additional packages have been used. For example, Plotly has been used to make our detailed graphics. In Plotly visualisations are displayed in an efficient way and many possibilities to visualize the data are present.


Resources
https://www.globalgoals.org/1-no-poverty
https://sdgcompass.org/sdgs/sdg-1/
https://ourworldindata.org/extreme-poverty
	
#### Chapter 2
	
#### Chapter 2

- Data understanding  introduce used databases + data descriptives

1.Initial data collection

Our data comes from World Development Indicators database(http://data.worldbank.org/data-catalog/world-development-indicators). On the website we could download the data, WDIData.csv. We focus on one of the UN Sustainable Development Goals, No Poverty. Data of over 1440 indicators of more than 200 countries and regions from 1960 to 2015 are provided in the WDI dataset, but only some of them are relevant to what we want to discuss about.  

And two problems has encountered when we try to acquire the data.

First, we narrow down the scope of indicators of the following fields that might be related to ‘No poverty’ goal:
1. Poverty headcount and poverty gap:
-Poverty headcount ratio at national poverty lines (% of population)
-Rural poverty headcount ratio at national poverty lines (% of rural population)
-Urban poverty headcount ratio at national poverty lines (% of urban population)
-Poverty headcount ratio at $1.90 a day (2011 PPP) (% of population)
-Poverty headcount ratio at $3.20 a day (2011 PPP) (% of population)
-Poverty headcount ratio at $5.50 a day (2011 PPP) (% of population)
-Poverty gap at $1.90 a day (2011 PPP) (%)
-Poverty gap at $3.20 a day (2011 PPP) (%)
-Poverty gap at $5.50 a day (2011 PPP) (%)
-Poverty gap at national poverty lines (%)
2. Social welfare:
-Coverage of social safety net programs (% of population)
-Coverage of social insurance programs (% of population)
3. Indicators that we decidede to use (life expectation, education,economy)

Secondly, we choose to start our analysis in a world level to have a first sight into the data, and then focus on some certain countries with data in relatively abnormal trend. 

Thirdly, we use the data from 1990 to 2015. The number of people living in extreme poverty dropped by more than half between 1990 and 2015. We want to find out the exact trend of how poverty has changed in the word thought out that period. Further more, we try to quantify the correlation between poverty in certain countries and the social welfare system in those countries to have a basic knowledge on how effective the social programs are.

Last, we want to predict the missing data on poverty with our regression model using predictors of life expectancy, education, and mortality of infants, and with the data we will get a fuller picture of how the poverty will be reduced in the future.



2.Data Description and quality problem 
We assume that indicators about social safety program, education, life expectation, mortality rate of infants are related to the poverty situation in countries. And we also make the hypothesis social safety program, education and life expectation have negative correlation with poverty, while mortality rate of infants is positively related to poverty. These indicators include scale of both social science and economy so that we could look into the properties of poverty with a broader scope. 

**Missing part: Quantity of the data:**
In the indicators we choose, a lot of data is missing. We have two solutions on the missing data. Strategy one is to drop off the data with a lot of missing part. The other way is more…

**What do we do with the missing data:**
For the world map, 

Also, we try to make a multiple regression model based on Baye’s rule using the predictors we choose, again within the predictors there are lot of missing data(i.e. NA in the predictor education). **how many missing data are there**
To deal with the problem, …



- Data preparation  how did we modify the data to properly use it 

1.Loading, choosing data we need and merging
Here we make a list of name of data in the fields that we are interested in, merge them in to one single longer list and make a subset of the data we want.

```{r}
# Read the data in correctly
mydata_utf8 = read.table("WDI/WDIData.csv",sep=",",fileEncoding="UTF-8-BOM",header=TRUE)  

# drop off the final blank column
mydata = mydata_utf8[,1:62]

dim(mydata)
all_code = unique(mydata[,1:2])
all_var = unique(mydata[,3:4])

# use the right countries
#country_code = read.table("data/WDI/country_code.csv",sep=",",header=FALSE)  
# listing all our variables and group them by UN targets or characteristics

Grouping_variables_population = list("SE.XPD.TOTL.GD.ZS","P.DYN.LE00.IN","SI.POV.NAGP","SP.DYN.LE00.IN","SE.XPD.TOTL.GD.ZS","SP.RUR.TOTL.ZS","SP.POP.GROW","SP.POP.TOTL","SP.POP.TOTL.MA.IN","SP.POP.TOTL.FE.IN","SP.URB.TOTL.IN.ZS", "SI.POV.URHC", "SP.RUR.TOTL.ZS", "SI.POV.RUHC", "SI.POV.DDAY", "SP.POP.TOTL")


Target_1_Headcount_Poverty_190_320_550 = list("SI.POV.DDAY","SI.POV.LMIC,SI.POV.UMIC","SI.POV.GAPS,SI.POV.LMIC.GP",
                                              "SI.POV.UMIC.GP")

Target_2_National_Poverty_Lines_Indicator = list("SI.POV.NAHC","SI.POV.RUHC","SI.POV.URHC","SI.POV.NAGP","SI.POV.RUGP",
                                              "SI.POV.URGP")

Target_3_A_Social_insurance_programm = list("per_si_allsi.cov_pop_tot",
                                         "per_si_allsi.cov_q2_tot",
                                         "per_si_allsi.cov_q3_tot",
                                         "per_si_allsi.cov_q4_tot",
                                         "per_si_allsi.cov_q1_tot",
                                         "per_si_allsi.cov_q5_tot",
                                         "per_allsp.cov_pop_tot")

Target_3_B_Social_Safety_Net_programm = list("per_sa_allsa.cov_pop_tot",
                                          "per_sa_allsa.cov_q2_tot",
                                          "per_sa_allsa.cov_q3_tot",
                                          "per_sa_allsa.cov_q4_tot",
                                          "per_sa_allsa.cov_q1_tot",
                                          "per_sa_allsa.cov_q5_tot")

Target_3_C_Social_Safety_Net_programm = list("per_lm_alllm.cov_pop_tot",
                                          "per_lm_alllm.cov_q2_tot",
                                          "per_lm_alllm.cov_q3_tot",
                                          "per_lm_alllm.cov_q4_tot",
                                          "per_lm_alllm.cov_q1_tot",
                                          "per_lm_alllm.cov_q5_tot")

indicators_income_share = list("SI.DST.04TH.20","SI.DST.10TH.10","SI.DST.05TH.20","SI.DST.FRST.10",
                            "SI.DST.FRST.20","SI.DST.02ND.20","SI.DST.03RD.20")

indicators_economy = list("NY.GNP.PCAP.CD","NY.GNP.MKTP.CN","FP.CPI.TOTL.ZG","NY.GDP.DEFL.KD.ZG","NY.GDP.DEFL.KD.ZG.AD",
                       "TX.VAL.MRCH.CD.WT","TX.VAL.MRCH.WL.CD","TM.VAL.MRCH.CD.WT","TM.VAL.MRCH.WL.CD","SI.POV.GINI")

indicators_life_span = list("SH.DTH.IMRT","SP.DTH.INFR.ZS","SP.DTH.INFR.ZS","SP.DYN.TO65.FE.ZS","SP.DYN.TO65.MA.ZS",
                         "SP.DYN.IMRT.IN","SP.DYN.IMRT.FE.IN","SP.DYN.IMRT.MA.IN")

#putting all indicators names in one list to merge all lists with a loop, see below
List_of_indicators_list = list(indicators_life_span,indicators_economy,indicators_income_share, Target_3_C_Social_Safety_Net_programm,Target_3_B_Social_Safety_Net_programm,Target_3_A_Social_insurance_programm,Target_2_National_Poverty_Lines_Indicator,Target_1_Headcount_Poverty_190_320_550,Grouping_variables_population)

my_vars = list()
for (i in List_of_indicators_list ) {
  my_vars = append(my_vars,i)
}
my_vars_c = c(my_vars)

```


2.Reshaping our data
But for purpose of easier use, we reshape the data into the format that in each row, there’s one value of an indicator in one country of one year, with the columns of country code, region, country name, indicator code, indicator name, year, and the value. Also we delete the “X” in the name of years.
```{r}
# subset the data - selected var with all years
#country_data = subset(mydata,mydata$Country.Code %in% country_code$V1)
indicator_data = subset(mydata,mydata$Indicator.Code %in% my_vars_c)

# subset the data - selected var with only 1990 - 2015 & prepare data for plotting
indicator_data_1990_2015 = indicator_data[,c(2:3,4:4,35:60)]
colnames(indicator_data_1990_2015) <- sub("X", "", colnames(indicator_data_1990_2015))

our_indicator_data= melt(indicator_data_1990_2015, id=c("Indicator.Code","Indicator.Name","Country.Code"), value.name = "Year")

```







#### Chapter 3 modelling and graphs
-	Define a descriptive model for the relevant data (Visual graphs)
-	Specify a prior distribution
-	Use Bayesian inference to discuss credibility across parameter values
7
First we explore our data, by analysing the data and to 


3 Data analysis
Within chapter 3, we try to answer our research question by means of several sub questions, see section 1.2. This is mainly done by analysing large datasets and trying to visualise this data by means of appropriate graphs. We try to gain more insight in the state of of poverty around the world. 



3.1 The state of poverty in the world
The code below plots the absolute number op people living in poverty (below 1.90$ a day) over the years 1980 till 2015
```{r}
library(plotly)
#layout
a <- list(
  title = "Years",
  showticklabels = TRUE,
  gridwidth = 2,
  autotick = F, 
  dtick = 2,
  range = c(0,25)
)
b <- list(
  title = "Number of people living in poverty (1,90$ a day)",
  showticklabels = TRUE,
  gridwidth = 2,
  range = c(-5000000,2000000000),
  showline = T
)
#plot the graph
plot_ly(wide, x = ~Year, y = ~absolute, type = 'scatter', mode = 'lines') %>% 
  layout(xaxis = a, yaxis = b)
```

```
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#selecting data from wdi + average of 6 years 2010 - 2015
colnames(our_indicator_data) = c("Country.Code","Region","Country.Name","Indicator.Code","Indicator.Name","Year", "value")
var_i = c("SI.POV.DDAY","SP.POP.TOTL")
#subset the data with only the world and the two indicators above about population and people in poverty in %
graph_data = subset(our_indicator_data,our_indicator_data$'Indicator.Code' %in% var_i)
graph_data = subset(graph_data,graph_data$'Year' %in% year)

test <- subset(graph_data, select = c("Indicator.Code","Country.Name", "Country.Code", "Year", "value"))
df_mean_pov = dcast(test,Country.Code + Country.Name + Indicator.Code ~ Year, value.var ="value")
df_mean_pov['mean'] = rowMeans(df_mean_pov[,4:9],na.rm = T)
df_mean_pov = dcast(df_mean_pov,Country.Code + Country.Name  ~ Indicator.Code, value.var ="mean")
colnames(df_mean_pov) = c("Country.Code","Country.Name","MeanHeadCount","MeanPop")
df_mean_pov$MeanPop = df_mean_pov$MeanPop/1000000
df_mean_pov$MeanHeadCount = df_mean_pov$MeanHeadCount/100
df_mean_pov['MeanPovPop'] = df_mean_pov[,3]*df_mean_pov[,4]
df_mean_pov$MeanHeadCount = df_mean_pov$MeanHeadCount*100
df_mean_pov$MeanPop = round(df_mean_pov$MeanPop,2)
df_mean_pov$MeanHeadCount = round(df_mean_pov$MeanHeadCount,2)
df_mean_pov$MeanPovPop = round(df_mean_pov$MeanPovPop,2)


# light grey boundaries
l <- list(color = toRGB("grey"), width = 0.5)

df_mean_pov$hover <- with(df_mean_pov, paste
                                     ( "Year: 2015",'<br>',
                                       "Percentage under extreme poverty line:",MeanHeadCount,"%" ,'<br>',
                                       "Mean population living in extreme poverty:",MeanPovPop,"M",'<br>',
                                       "Total population:",MeanPop,"M",'<br>', 
                                       "Country:", Country.Name))

# specify map projection/options
g <- list(
  resolution = 5,
  showcoastlines = T,
  countrycolor = toRGB("grey"),
  coastlinecolor = toRGB("grey"),
  projection = list(type = 'Mercator') 
)

k <- plot_geo(df_mean_pov) %>%
  add_trace(z = ~MeanHeadCount,text = ~hover, color = ~MeanHeadCount, colors= 'Reds', 
            locations = ~Country.Code, 
            marker = list(line = l,color = 'rgb(255,255,255)')) %>%
  
  colorbar(title = 'Percentage of total population living extreme poverty') %>%
  layout(
    title = 'Prevalance of Extreme Poverty during 2010 - 2015 (below 1.90$ a day)',
    geo = g )
k
```
```
#### Plotting the gini indices
Below is the code for plotting the gini indices for the eight countries with the lowest Gini index according to the data from the world map.

```{r}

library(reshape)
library(reshape2)
library(ineq)
library(plotly)

# indicator code for gini index
my_vars_c = c("SI.POV.GINI")
# subset the data - selected var 
indicator_datagini = subset(indicator_data,indicator_data$Indicator.Code %in% my_vars_c)

# LINE PLOT FOR THE COUNTRIES WITH THE HIGHEST GINI INDEXES
# extract the right years (25:60 is 1980 till 2015)
id = indicator_datagini[,c(1:3,4:4, 25:60)]
# remove the 'X' in the columns
colnames(id) <- sub("X", "", colnames(id))
# change the format
idm = melt(id, id=c("Indicator.Code","Indicator.Name","Country.Code", "Country.Name"), value.name = "Year")
# throw away the rows with missing data
idm <- na.omit(idm, cols="value")

# subset with only those countries
cl <- c("MDG","BDI","MWI","GNB","MOZ","ZMB","LSO")
idmc <- subset(idm,idm$Country.Code %in% cl)
# plot the gini idexes of those countries over time
x <- list( title = "Years" )
y <- list( title = "Gini Index" )
m <- list(l=150, r=20, b=70, t=10)
pline <- plot_ly(idmc, x = ~idmc$variable, y = ~idmc$value, color = ~idmc$Country.Code) %>%
  add_lines(line = list(shape = "spline"))  %>% layout(xaxis = x, yaxis = y, margin=m)
pline

# PLOT THE LORENZ CURVE OF ONE OF THE COUNTRIES (if a flat line occurs, there is no data)
# Get the indicators for the lorenz curve
my_var = c( "SI.DST.05TH.20","SI.DST.02ND.20","SI.DST.03RD.20", "SI.DST.04TH.20", "SI.DST.FRST.20")
# fill in country code in V1 and run code below
V1 = c("LSO")
# subset the data with only the country and the needed indicators
country_data = subset(indicator_data,indicator_data$Country.Code %in% V1)
COUNTRY_LC_V1 = subset(country_data,country_data$Indicator.Code %in% my_var)
# slice the needed data for the desirable year
COUNTRY_2015 = COUNTRY_LC_V1[,c(1:4,55:55)]
# create a vector for the lorenz curve function
p20 = c( 20, 40, 60 , 80, 100)
# sort the values of the indicators. Make sure the year is the right one
d20 = sort(COUNTRY_2015$X2010)
# plot the lorenz curve
Lc.c <- Lc(d20, p20)
plot(Lc.c)

gini_index_country = Gini(d20)

```

#### Chapter 4 evaluation
- evaluation
-	Discuss research findings to quality of the model, quality of the data. 
-	How could the model be improved  suggest next steps
#### Chapter 5 development
	- Can we predict future behaviour/Guide additional policy
	- How would we communicate our findings to decision makers? 



Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
