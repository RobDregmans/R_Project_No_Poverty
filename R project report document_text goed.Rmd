---
title: "R Project Report"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = "C:/Users/rob/Documents/GitHub/data")
knitr::opts_chunk$set(comment=NA, fig.width=8, fig.height=8, fig.align = "center")
library(reshape)
library(reshape2)
library(dplyr)
library(tidyr)
library(plotly)
library(ineq)
library(ggplot2)
```

### Report storyline

## 1 Problem analysis

### 1 Introduction to poverty
The world has committed itself to intensive targets for reducing poverty by 2030. The goal to reduce poverty and its related side effects are specified in Sustainable Development Goal (SDG) number one of the total seventeen SDG's set up in the 2030 Agenda for Sustainable Development. All seventeen goals and quantitative targets are meant to stimulate action over the next fifteen years in areas of critical importance for humanity and the planet [2]. 

### 1.1 UN Targets

The negative effects of poverty are enormous. Poverty and related effects slow down development within whole countries. Certain groups are disproportionately represented and face additional constraints, such as limited access to resources and capabilities in escaping poverty. These include women, persons with disabilities, children, and indigenous peoples.

- Target 1: By 2030, eradicate extreme poverty for all people everywhere, currently measured as people living on less than $1.25 a day.

- Target 2: By 2030, reduce at least by half the proportion of men, women and children of all ages living in poverty in all its dimensions according to national definitions.

- Target 3: Implement nationally appropriate social protection systems and measures for all, including floors, and by 2030 achieve substantial coverage of the poor and the vulnerable.

- Target 4: By 2030, ensure that all men and women, in particular the poor and the vulnerable, have equal rights to economic resources.

-	Target 5: By 2030, build the resilience of the poor and those in vulnerable situations.

### 1.2 The role of data in battling poverty

To mobilise resources to overcome inequalities between developed and developing countries data is needed. Data is widely used within decision-making and forms the raw material for accountability of policies. Today, in the private sector, analysis of big data is common for example with consumer profiling and personalised services. Similar techniques are being adopted to gain real-time insights into people’s wellbeing and to target aid interventions to vulnerable groups [2]. Sources of data, if applied responsibly, can enable more evidence-based decision-making, hereby contributing to making progress on the Sustainable Development Goals (SDGs) [1].

This is where a problem lies for analysing the poverty problem. Within the World Development Indicators, a lot of data is missing on various indicators on poverty. According to the IEG, reaching the UN targets faces many obstacles, among one of them is the lack of regularly high-quality data. Of the 139 developing countries, 22 have no data for the past three decades, some 30 countries have not had a survey in the past decade, and 20 countries only have had one survey since 2000 [2]. 

What is even more striking, is that one third of these countries are in Sub-Saharan Africa, where poverty is most frequent. Furthermore, from the countries that are reporting new surveys, eighty percent are from middle-income economies or higher. Also, additions to the survey database have been declining in recent years and the number of surveys within five years of a given date are declining rapidly [2].

One of the problems of building and maintaining a usable poverty database are financial, it would cost around 30 million/year to continuously perform surveys in 77 lower income countries. But these costs are not the main problem. There is also an enormous lack of political will within the government to proper store poverty data. Political will covers a multitude of obstacles from a refusal to collect data to unwillingness to release data for analysis. Also, many surveys on poverty known to World Bank staff are not available to other analysts or even to the citizens of the country [3].

### 1.3 Goal of this report

The success of the Sustainable Development Goals will be judged on what the data is telling us about their current state. For SDG 1, this will be mainly done in achieving the headline indicator of extreme poverty reduction, which is the share the population in a country living under the extreme poverty line of 1.90 a day. Without better poverty data, collected more frequently, and open to all, we will never know if that goal can be achieved. This can be done by collecting data, but it would take a lot of time to gather all this data and process it. Therefore, the main goal of this report is constructing a predictive model on basis of indicators that are related to poverty. We also try to get it an insight in the current state of poverty around the world to determine if our model predictions are accurate enough. 

### 1.4 Research questions

Our main research question is twofold. The main part is about constructing a model that predicts poverty for various countries around the world. Besides that, we try to explore the current state of poverty and the distribution of wealth around the world. 

*Our main research question is:*
*What was the development of poverty around the world since 1990 and can we predict the prevalence of extreme poverty within countries based on a predictive bayesian model? 

*To answer this research, several sub questions are defined:*

•	Question 1: How did poverty in both absolute and multi-level poverty develop from 1990 – 2015 within regions and individual countries?
•	Question 2: How is wealth distributed within countries with the highest poverty headcount?
•	Question 3: Which indicators resemble good estimators for our poverty model?
•	Question 4: What are the parameters of our MCMC model to estimate the prevalence of poverty for countries with missing data?
•	Question 5: What is the accuracy of our predictive model?

### 1.5 Methodology 

Within this report, we try to gain more insight behind the data of poverty around the world. First, we will clean and analyse the data by selecting the relevant indicators. By means of critical analysis and interpretation of figures and numbers, we try to find relations in the data to obtain useful indicators for our model. Also, relevant primary research on the topic of poverty will be included to compare our primary research findings.

R-studio is used as a tool to perform the data analysis within this research. R is widely used as a programming language for the visualisation of data. It contains additional packages that are very powerful for data analysis and visualisation purposes. Within our computations in R, several additional packages have been used. For example, Plotly has been used to make our detailed graphics. In Plotly visualisations are displayed in an efficient way and many possibilities to visualize the data are present. We also use several scripts provided within this course to estimate our model. 


Resources
[1] https://www.globalgoals.org/1-no-poverty
[2] https://sdgcompass.org/sdgs/sdg-1
[3] https://ourworldindata.org/extreme-poverty
[4] http://pubdocs.worldbank.org/en/109701443800596288/PRN03Oct2015TwinGoals.pdf
[5] https://opendatawatch.com/blog/ending-poverty-needs-better-data/
[6] http://ieg.worldbankgroup.org/sites/default/files/Data/reports/poverty_focus_cp_1.pdf
[7] 7https://qz.com/africa/1428639/world-banks-measure-of-poverty-is-flawed/
http://www.un.org/en/sections/issues-depth/big-data-sustainable-development/index.html
	
#### Chapter 2

- Data understanding  introduce used databases + data descriptives

1.Initial data collection

Our data comes from World Development Indicators database(http://data.worldbank.org/data-catalog/world-development-indicators). On the website we could download the data, WDIData.csv. We focus on one of the UN Sustainable Development Goals: No Poverty. Data of over 1440 indicators of more than 200 countries and regions from 1960 to 2015 are provided in the WDI dataset, but only some of them are relevant to what we want to discuss about.  

We encounter two problems when we try to acquire the data.

First, we narrow down the scope of indicators of the following fields that might be related to ‘No poverty’ goal. This includes the following indicators:

1. Poverty headcount and poverty gap:
-Poverty headcount ratio at national poverty lines (% of population)
-Rural poverty headcount ratio at national poverty lines (% of rural population)
-Urban poverty headcount ratio at national poverty lines (% of urban population)
-Poverty headcount ratio at $1.90 a day (2011 PPP) (% of population)
-Poverty headcount ratio at $3.20 a day (2011 PPP) (% of population)
-Poverty headcount ratio at $5.50 a day (2011 PPP) (% of population)
-Poverty gap at $1.90 a day (2011 PPP) (%)
-Poverty gap at $3.20 a day (2011 PPP) (%)
-Poverty gap at $5.50 a day (2011 PPP) (%)
-Poverty gap at national poverty lines (%)

2. Social welfare:
-Coverage of social safety net programs (% of population)
-Coverage of social insurance programs (% of population)

3. Indicators that we decidede to use (life expectation, education,economy)

Secondly, we choose to start our analysis in a world level to have a first sight into the data, and then focus on some certain countries with data in relatively abnormal trend. 

Thirdly, we mostly use the data from 1990 to 2015. The number of people living in extreme poverty dropped by more than half between 1990 and 2015. We want to find out the exact trend of how poverty has changed in the word thought out that period. Further more, we try to quantify the correlation between poverty in certain countries and the social welfare system in those countries to have a basic knowledge on how effective the social programs are. 

Last, we want to predict the missing data on poverty with our regression model using predictors of life expectancy, education, and mortality of infants, and with the data we will get a fuller picture of how the poverty will be reduced in the future.

2.Data Description and quality problem

We assume that indicators about social safety program, education, life expectation, mortality rate of infants are related to the poverty situation in countries. And we also make the hypothesis that social safety program, education and life expectation have negative correlation with poverty, while mortality rate of infants is positively related to poverty. These indicators include scales of both social science and economy so that we could look into the properties of poverty with a broader scope. 
But in the indicators we choose, a lot of data is missing. We have two solutions on the missing data. The first solution is to drop off the data with missing part. The other way is to estimate the missing data with our regression model.


- Data preparation  how did we modify the data to properly use it 
1.Loading, choosing and merging the data
After we load the data and using the file encoding type as UTF-8, we make several changes to make the dataset neater. We drop off all the final blank columns which contain no data at all. 

```{r}
# Read the data in correctly
mydata_utf8 = read.table("WDI/WDIData.csv",sep=",",fileEncoding="UTF-8-BOM",header=TRUE)  

# drop off the final blank column
mydata = mydata_utf8[,1:62]

all_code = unique(mydata[,1:2])
all_var = unique(mydata[,3:4])

# use the right countries
#country_code = read.table("data/WDI/country_code.csv",sep=",",header=FALSE)  
# listing all our variables and group them by UN targets or characteristics
```

And then extract the list of countries and indicators concluded in the file by using function unique. Here we make a list of name of data that we are interested in, and group them according to the scopes they belong to. Then we merge them in to one single longer data frame and make a subset of the data between 1995 and 2015.

```{r}
Grouping_variables_population = list("SI.POV.NAGP","SP.RUR.TOTL.ZS","SP.POP.GROW","SP.POP.TOTL","SP.POP.TOTL.MA.IN","SP.POP.TOTL.FE.IN","SP.URB.TOTL.IN.ZS", "SI.POV.URHC", "SP.RUR.TOTL.ZS", "SI.POV.RUHC", "SI.POV.DDAY", "SP.POP.TOTL")

Predictor_variables = list("SP.DYN.LE00.IN","SE.XPD.TOTL.GD.ZS", "SE.XPD.TOTL.GD.ZS","SN.ITK.DEFC.ZS","SH.DYN.MORT")

Target_1_Headcount_Poverty_190_320_550 = list("SI.POV.DDAY","SI.POV.LMIC,SI.POV.UMIC","SI.POV.GAPS","SI.POV.LMIC.GP","SI.POV.UMIC.GP")

Target_2_National_Poverty_Lines_Indicator = list("SI.POV.NAHC","SI.POV.RUHC","SI.POV.URHC","SI.POV.NAGP","SI.POV.RUGP",
                                              "SI.POV.URGP")

Target_3_A_Social_insurance_programm = list("per_si_allsi.cov_pop_tot",
                                         "per_si_allsi.cov_q2_tot",
                                         "per_si_allsi.cov_q3_tot",
                                         "per_si_allsi.cov_q4_tot",
                                         "per_si_allsi.cov_q1_tot",
                                         "per_si_allsi.cov_q5_tot",
                                         "per_allsp.cov_pop_tot")

Target_3_B_Social_Safety_Net_programm = list("per_sa_allsa.cov_pop_tot",
                                          "per_sa_allsa.cov_q2_tot",
                                          "per_sa_allsa.cov_q3_tot",
                                          "per_sa_allsa.cov_q4_tot",
                                          "per_sa_allsa.cov_q1_tot",
                                          "per_sa_allsa.cov_q5_tot")

Target_3_C_Social_Safety_Net_programm = list("per_lm_alllm.cov_pop_tot",
                                          "per_lm_alllm.cov_q2_tot",
                                          "per_lm_alllm.cov_q3_tot",
                                          "per_lm_alllm.cov_q4_tot",
                                          "per_lm_alllm.cov_q1_tot",
                                          "per_lm_alllm.cov_q5_tot")

indicators_income_share = list("SI.DST.04TH.20","SI.DST.10TH.10","SI.DST.05TH.20","SI.DST.FRST.10",
                            "SI.DST.FRST.20","SI.DST.02ND.20","SI.DST.03RD.20")

indicators_economy = list("NY.GNP.PCAP.CD","NY.GNP.MKTP.CN","FP.CPI.TOTL.ZG","NY.GDP.DEFL.KD.ZG","NY.GDP.DEFL.KD.ZG.AD",
                       "TX.VAL.MRCH.CD.WT","TX.VAL.MRCH.WL.CD","TM.VAL.MRCH.CD.WT","TM.VAL.MRCH.WL.CD","SI.POV.GINI")

indicators_life_span = list("SH.DTH.IMRT","SP.DTH.INFR.ZS","SP.DTH.INFR.ZS","SP.DYN.TO65.FE.ZS","SP.DYN.TO65.MA.ZS",
                         "SP.DYN.IMRT.IN","SP.DYN.IMRT.FE.IN","SP.DYN.IMRT.MA.IN")

#putting all indicators names in one list to merge all lists with a loop, see below
List_of_indicators_list = list(Predictor_variables,indicators_life_span,indicators_economy,indicators_income_share, Target_3_C_Social_Safety_Net_programm,Target_3_B_Social_Safety_Net_programm,Target_3_A_Social_insurance_programm,Target_2_National_Poverty_Lines_Indicator,Target_1_Headcount_Poverty_190_320_550,Grouping_variables_population)

my_vars = list()
for (i in List_of_indicators_list ) {
  my_vars = append(my_vars,i)
}
my_vars_c = c(my_vars)
# subset the data 
indicator_data = subset(mydata,mydata$Indicator.Code %in% my_vars_c)
# subset the data - selected var with only 1990 - 2015
indicator_data_1990_2015 = indicator_data[,c(2:3,4:4,35:60)]


```

2.Reshaping
But for purpose of easier use, we reshape the data into the format that in each row, there’s one value of an indicator in one country of one year, with the columns of country code, region, country name, indicator code, indicator name, year, and the value. This is also known as a wide to long format transformation. We delete the “X” in the name of years, for the potential usage of the scale of time in the temporal distribution in the following part in the report.

```{r}
colnames(indicator_data_1990_2015) <- sub("X", "", colnames(indicator_data_1990_2015))
our_indicator_data= melt(indicator_data_1990_2015,id=c("Indicator.Code","Indicator.Name","Country.Code"), value.name = "Year")
#setting up indicator data with country names from python @martijn
country_names = read.table("country_names.csv",sep = ",", header = TRUE)
country_wdi = country_names[,c(1:2,5:5)]

colnames(country_wdi) = c("Country.Code","Region","Region/Country Name")
our_indicator_data = merge(country_wdi,our_indicator_data,id = "Country.Code")
colnames(our_indicator_data)=c("Country.Code","Region","Country.Name","Indicator.Code","Indicator.Name","Year","Value")
```


And then we make a name list of the countries involved in the subset of indicators we choose. Also we want to make some analysis on the level of region level so we extract the 
name list of the regions as well.


```{r}
#Obtaining lists for information about regions and countries
all_region_and_country_codes=our_indicator_data[,1:3]
all_region_and_country_codes=unique(all_region_and_country_codes)
all_regions = subset(all_region_and_country_codes, all_region_and_country_codes$Region == "")
all_countries = subset(all_region_and_country_codes, all_region_and_country_codes$Region != "")

#did a work around because factor levels in R
general_regions = unique(all_countries['Region'])
region_list = c('Latin America & Caribbean','South Asia','Sub-Saharan Africa','Europe & Central Asia','Middle East & North Africa','East Asia & Pacific','North America')

#Subset to extract regions
regions_used = subset(all_regions, all_regions$'Region/Country Name' %in% region_list)
regions_used = regions_used[,-c(2)]
```

3.Data preparation for further graphs drawing 

In this part we want to prepare the data for the bubble charts about poverty and life expectancy, which indicates the correlation between these two indicators. We calculate the Total population of people who live in poverty by multiple two indicators: all population in the country and the poverty headcount ratio at $1.90 a day. 

```{r}
#making bubble chart of poverty 3.10 and life expectancy
var_i = c("SH.DYN.MORT","SI.POV.DDAY","SP.POP.TOTL")

#subset the data with only the world and the two indicators above about population and people in poverty and life expectancy
bubble_chart_1 = subset(our_indicator_data,our_indicator_data$'Indicator.Code' %in% var_i)
test <- subset(bubble_chart_1, select = c("Indicator.Code","Region", "Country.Name", "Country.Code", "Year", "Value"))
df_bubble = dcast(test,Country.Code + Country.Name + Region + Year ~ Indicator.Code, value.var ="Value")
df_bubble_2013 = df_bubble[which(df_bubble$Year == 2012),]
df_bubble_2013$SP.POP.TOTL = df_bubble_2013$SP.POP.TOTL/1000000
df_bubble_2013$SI.POV.DDAY = df_bubble_2013$SI.POV.DDAY/100
df_bubble_2013$TotalPopPov = df_bubble_2013$SI.POV.DDAY * df_bubble_2013$SP.POP.TOTL

colnames(df_bubble_2013) = c("Country.Code", "Country.Name","Region","Year","ChildMort", "Poverty","TotalPop","TotalPopPov")
```

In this chart we only want to discuss at the national level instead of at regional level, so we exclude all the regional data as well as any NA value. And then we fix the data to the format with two decimals.

```{r}
#omit NA's
df_bubble_2013_na = na.omit(df_bubble_2013)
#order to omit regions, only hold countries
df_bubble_2013_na = df_bubble_2013_na[order(df_bubble_2013_na$Region, df_bubble_2013_na$Country.Name),]
k = as.numeric(dim(df_bubble_2013_na))[1]
df_bubble_2013_na_se = df_bubble_2013_na[c(13:k),]
#fix values with to many decimals and poverty percentage value
df_bubble_2013_na_se$Poverty = df_bubble_2013_na_se$Poverty *100
df_bubble_2013_na_se$Poverty = round(df_bubble_2013_na_se$Poverty,2)
df_bubble_2013_na_se$TotalPop = round(df_bubble_2013_na_se$TotalPop,2)
df_bubble_2013_na_se$TotalPopPov = round(df_bubble_2013_na_se$TotalPopPov,2)
df_bubble_2013_na_se$ChildMort = round(df_bubble_2013_na_se$ChildMort,2)

#CODE FOR MAKING THE BUBBLE CHATY OF POVERTY AND LIFE EXPECTANCY
#making bubble chart of poverty 1.90 and life expectancy
var_i = c("SP.DYN.LE00.IN","SI.POV.DDAY","SP.POP.TOTL")

#subset the data with only the world and the two indicators above about population and people in poverty and life expectancy
graph_data = subset(our_indicator_data,our_indicator_data$'Indicator.Code' %in% var_i)
test <- subset(graph_data, select = c("Indicator.Code","Region", "Country.Name", "Country.Code", "Year", "Value"))
df_bubble = dcast(test,Country.Code + Country.Name + Region + Year ~ Indicator.Code, value.var ="Value")
df_bubble_2013 = df_bubble[which(df_bubble$Year == 2012),]
df_bubble_2013$SP.POP.TOTL = df_bubble_2013$SP.POP.TOTL/1000000
df_bubble_2013$SI.POV.DDAY = df_bubble_2013$SI.POV.DDAY/100
df_bubble_2013$TotalPopPov = df_bubble_2013$SI.POV.DDAY * df_bubble_2013$SP.POP.TOTL

colnames(df_bubble_2013) = c("Country.Code", "Country.Name","Region","Year","Poverty","LifeExpec","TotalPop","TotalPopPov")

#omit NA
df_bubble_2013_na = na.omit(df_bubble_2013)
#order to omit regions only hold countries
df_bubble_2013_na = df_bubble_2013_na[order(df_bubble_2013_na$Region, df_bubble_2013_na$Country.Name),]
k = as.numeric(dim(df_bubble_2013_na))[1]
df_bubble_2013_na = df_bubble_2013_na[c(13:k),]
#fix values with to many decimals and poverty percentage value
df_bubble_2013_na$Poverty = df_bubble_2013_na$Poverty *100
df_bubble_2013_na$Poverty = round(df_bubble_2013_na$Poverty,2)
df_bubble_2013_na$TotalPop = round(df_bubble_2013_na$TotalPop,2)
df_bubble_2013_na$TotalPopPov = round(df_bubble_2013_na$TotalPopPov,2)
df_bubble_2013_na$LifeExpec = round(df_bubble_2013_na$LifeExpec,2)
df_bubble=merge(df_bubble_2013_na,df_bubble_2013_na_se,id= "Country.Code", all.x = T)
```

## 3 Data exploration
Within chapter 3, we try to answer our research question by means of several sub questions, see section 1.2. This is mainly done by analysing large datasets and trying to visualise this data by means of appropriate graphs. We try to gain more insight in the state of of poverty around the world.

Firstly, the current state of hunger in the world shall be analysed by looking at the prevalence of poverty around the world, see section 3.1. Here we will discuss the problem of missing data in terms of estimating the poverty headcount within countries over longer time period. To answer the second research question, we will look at the distribution of wealth by analysing GINI indexes and Lorenz curves, see section 3.2. For the third research question, we plot several bubble charts and consider correlation between variables in our data, see section 3.3.


### 3.1 The state of poverty in the world
code
```{r}
#FOR THE LINECHART ABOUT ABSOLUTE POVERTY
world = c("WLD")
var_i = c("SI.POV.DDAY", "SP.POP.TOTL")
#subset the data with only the world and the two indicators above about population and people in poverty in %
graph_absolute = subset(our_indicator_data,our_indicator_data$'Indicator.Code' %in% var_i)
graph_absolute = subset(graph_absolute,graph_absolute$'Country.Code' %in% world)
graph_absolute = graph_absolute[,c(4:7)]
#split the indicator column into two columns
wide = dcast(graph_absolute,Year ~ Indicator.Code,  value.var = "Value")
#this is a workaround for getting for each year the value for the two indicators into the same row
#omit all na values
wide <- na.omit(wide)

#multiply the data to get the absolute number of people living in poverty
wide$absolute <- (wide$SI.POV.DDAY/100) * (wide$SP.POP.TOTL/(10^9))
wide$absolute = round(wide$absolute,3)

#add hover text
wide$hover = with(wide, paste( "Year:", Year ,
                               "<br> World population living in extreme poverty:",absolute,"M",
                               "<br> Share of global population:", SI.POV.DDAY,"%"))
```

The graph below shows the absolute number op people living in poverty (below 1.90$ a day) over the years 1980 till 2015. The graph is interactive, when you hover over it more information about the share of the total word population living in poverty becomes visible.

In the graph we see the absolute number of people living in poverty, which means they have only 1.90$ a day to spend. The data from this graph is aquired by multiplying the percentage of people living in poverty by the total population of that same country. All these numbers are summed and then displayed. We can see that the absolute number of people living in poverty is rapidly declining, but nevertheless way to high. Whereas in 1990 1898 million people where living in poverty, now in 2015 that number is 736 million. Note that this is the absolute number of people living in poverty and that the number is not corrected for the trend in population growth. So in a more optimistic view, even since the world population has risen, the absolute number of people living in poverty is declining.
```{r}
#layout
a <- list(
  title = "Years",
  showticklabels = TRUE,
  gridwidth = 2,
  autotick = F, 
  dtick = 2,
  range = c(0,25),
  showline = T
)
b <- list(
  title = "Number of people living in poverty (1,90$ a day)",
  showticklabels = TRUE,
  gridwidth = 2,
  showline = T,
  range = c(0,2)
)
#plot the graph
plot_ly(wide, x = ~Year, y = ~absolute, text = ~hover ,type = 'scatter', mode = 'lines') %>% 
  layout(xaxis = a, yaxis = b, title = 'Global population living in extreme poverty 1990 - 2015')
```


#### Distribution over regions
code for stacked line graph

```{r}
poverty_gap_data <- subset(mydata,mydata$Indicator.Code=="SI.POV.GAPS")
poverty_gap_data_1990 <- poverty_gap_data[,c(1:3,4:4, 35:60)]
# remove the 'X' in the columns
colnames(poverty_gap_data_1990) <- sub("X", "", colnames(poverty_gap_data_1990))
#remove the rows without any data
poverty_gap_withoutNA <- poverty_gap_data_1990[-which(rowSums(is.na(poverty_gap_data_1990))>24),]
#reshape the data for drawing graphs
poverty_melt = melt(poverty_gap_withoutNA, id=c("Indicator.Code","Indicator.Name","Country.Code", "Country.Name"), value.name = "Year")
#stacked area graph
##poverty line $1.90, six regions in one graph
regions_melt <- subset(poverty_melt, Country.Name =="East Asia & Pacific" | Country.Name =="Europe & Central Asia"| Country.Name =="Latin America & Caribbean"| Country.Name =="Middle East & North Africa"| Country.Name =="South Asia"| Country.Name =="Sub-Saharan Africa")
```

Below, we provided an overview of recent poverty trends for the standard ISO-regions, as provided by the OECD. The figure provides regional estimates of poverty rates (i.e. the share of population in each region living below the International Poverty Line). The poverty gap correspond to the International Poverty Line, at 1.90 int.$ in 2011 PPP prices.

In Sub-Saharan Africa and South Asia, the  number of people in extreme poverty has increased, but since 2010, the absolute number of people in extreme poverty is declining in all world regions.

```{r,fig.width=9}
gg <- ggplot(regions_melt, aes(x=as.numeric(as.character(variable)), y=value))
gg <- gg + geom_area(aes(fill=Country.Name))
#the color of the stacked area
gg = gg + scale_fill_brewer(palette="Greens", breaks=rev(levels(regions_melt$Country.Name)))
#label name
gg <- gg + labs(x="Year", y="Poverty ratio",col="Regions")
#label of the legend
gg <- gg + guides(fill = guide_legend(title = "Region"))
#remove the background and grid
gg <- gg + theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
                              panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"))
gg

```

Code for worldmap

``` {r}
knitr::opts_chunk$set(echo = TRUE)

#selecting data from wdi + average of 6 years 2010 - 2015
var_i = c("SI.POV.DDAY","SP.POP.TOTL")
year = c('2010','2011', '2012','2013','2014','2015')

#subset the data with only the world and the two indicators above about population and people in poverty
geo_map_average = subset(our_indicator_data,our_indicator_data$'Indicator.Code' %in% var_i)
geo_map_average = subset(geo_map_average,geo_map_average$Year %in% year)
geo_map_average <- subset(geo_map_average, select = c("Indicator.Code","Country.Name", "Country.Code", "Year", "Value"))

#Calculate average over columns
df_mean_pov = dcast(geo_map_average,Country.Code + Country.Name + Indicator.Code ~ Year, value.var ="Value")
df_mean_pov['mean'] = rowMeans(df_mean_pov[,4:9],na.rm = T)
df_mean_pov = dcast(df_mean_pov,Country.Code + Country.Name  ~ Indicator.Code, value.var ="mean")
colnames(df_mean_pov) = c("Country.Code","Country.Name","MeanHeadCount","MeanPop")

#fix indicator values for plotting and calculate poverty population
df_mean_pov$MeanPop = df_mean_pov$MeanPop/1000000
df_mean_pov['MeanPovPop'] = df_mean_pov[,3]*(df_mean_pov[,4]/100)
df_mean_pov$MeanPop = round(df_mean_pov$MeanPop,2)
df_mean_pov$MeanHeadCount = round(df_mean_pov$MeanHeadCount,2)
df_mean_pov$MeanPovPop = round(df_mean_pov$MeanPovPop,2)
```

The worldmap is showing the prevalence of poverty displayed per country. What immediately attracks the eye are the big red spots in Africa, where the prevalence of poverty is the highest. However, there are also a lot of white spots, which represent missing data. To get an better idea of the real prevalence of poverty in Africa, we need to do something about that missing data.

```{r, layout="l-screen-inset", , fig.width=13, fig.height=8}

# light grey boundaries
l <- list(color = toRGB("grey"), width = 0.5)

df_mean_pov$hover <- with(df_mean_pov, paste
                                     ( "Year: 2015",'<br>',
                                       "Percentage under extreme poverty line:",MeanHeadCount,"%" ,'<br>',
                                       "Mean population living in extreme poverty:",MeanPovPop,"M",'<br>',
                                       "Total population:",MeanPop,"M",'<br>', 
                                       "Country:", Country.Name))

# specify map projection/options
g <- list(
  showframe = F,
  resolution = 5,
  showcoastlines = T,
  countrycolor = toRGB("grey"),
  coastlinecolor = toRGB("grey"),
  projection = list(type = 'Mercator'))

k <- plot_geo(df_mean_pov) %>%
  add_trace(z = ~MeanHeadCount,text = ~hover, color = ~MeanHeadCount, colors= 'Reds', 
            locations = ~Country.Code, 
            marker = list(line = l,color = 'rgb(255,255,255)')) %>%
  
  colorbar(title = 'Percentage of total population living extreme poverty') %>%
  layout(title = 'Prevalance of Extreme Poverty during 2010 - 2015 (below 1.90$ a day)',geo = g)
k
```


### Section 3.2 Distribution of wealth
The Multidimensional Poverty Index (MPI) published by the Oxford Poverty & Human Development Initiative (OPHI). The MPI is not aggregated at the country level, but at the individual level—it measures how one individual is deprived in different 'poverty' dimensions.

The MPI is constructed from ten indicators across three core dimensions: health, education and living standards. In the following map below, we plotted the share of MPI poor people country by country. The multidimensional poverty index not only uses regular economic indicators such as income, consumption and GINI data, but also non-economic indicators such as nutrition, electricity and schooling. 


code documentation for code below

```{r}
#Selecting MDI Data, drop last 3 columns with no values
MPIData = read.table("MPIData.csv",sep=";",header=TRUE)  
colnames(MPIData)[1] <- "CountryCode"
MPIData = MPIData[,1:20]

#Selecting MDI Data, drop last 3 columns with no values
MPIData2016 = read.table("MPIData2016.csv",sep=";",header=TRUE)  
colnames(MPIData2016)[1] <- "PublishYear"

# light grey boundaries
l <- list(color = toRGB("grey"), width = 0.5)

MPIData2016$hover <- with(MPIData2016, paste
                      ( "Year:", SurveyYear,
                            "<br> Country:", Country,
                            "<br> Share of the pop. in Multi Level Poverty: ", Headcount.ratio ,"%",
                            "<br> Multi Poverty Index:", MPI,
                            "<br> Child school attendace:", ChildSchoolAttendance))
```

Using the MPI to map poverty around the world, it provides us with a more clear picture of how prevalent poverty currently is around the globe. As we can see, this alternative metric shows that poverty is also particularly prevalant in sub-Saharan Africa, but also in India and Afghanistan. It is still a limitation that the MPI data relies heavenly on aggregated multi year data. So it is not possible to track the progress of countries on their MPI for individual years, just like the wolrd map of the prevelance of poverty we plotted over the 5 years average. So we are still looking for ways to get a better picture of the prevalence of poverty.

Source:
https://ourworldindata.org/extreme-poverty#correlates-determinants-and-consequences

```{r, layout="l-screen-inset", , fig.width=13, fig.height=8}
                          
# specify map projection/options
g <- list(
  showframe = F,
  resolution = 5,
  showcoastlines = T,
  countrycolor = toRGB("grey"),
  coastlinecolor = toRGB("grey"),
  projection = list(type = 'Mercator') 
)

k <- plot_geo(MPIData2016) %>%
  add_trace(z = ~Headcount.ratio,text = ~hover, color = ~Headcount.ratio, colors = 'YlGnBu' ,
            locations = ~CountryCode, 
            marker = list(line = l,color = 'rgb(255,255,255)')) %>%
  
  colorbar(show = F, title = 'Share of population living in MPI',legend = list(x = 100, y = 0.5),legend = list(orientation = 'h')) %>%
  layout(
    title = 'Share of population per country trapped in multi level poverty',
    geo = g )
k
```




#### Plotting the gini indices
Below is the code for plotting the gini indices for the eight countries with the lowest Gini index according to the data from the world map. The Gini index is a measure for how wealth is distributed in a certain country. The higher the Gini index, the more inequal the wealth is distributed. The theoratical maximum value is nearly 100, where all the wealth is with less than one percent of the population. If the Gini index is 0, it represents complete equality in wealth distribution, so that everyone has the samen wealth. In general wealth is measured in income.

```{r}
#CODE FOR THE GINI INDICES
# subset the data - selected var GINI
indicator_datagini = subset(indicator_data,indicator_data$Indicator.Code=="SI.POV.GINI")

# LINE PLOT FOR THE COUNTRIES WITH THE HIGHEST GINI INDEXES
# extract the right years (25:60 is 1980 till 2015)
id = indicator_datagini[,c(2:3,4:4, 25:60)]
# remove the 'X' in the columns
colnames(id) <- sub("X", "", colnames(id))
# change the format
idm = melt(id, id=c("Indicator.Code","Indicator.Name","Country.Code"), value.name = "Year")
# throw away the rows with missing data
idm <- na.omit(idm, cols="value")
```

From the graph we can conclude that the Gini indices for the seven plotted countries in general oscilates between 35 and 65. We can also see that for the most countries there is not a lot of progression over the last 35 years. For example, Madagascar had a Gini index of 46,8 in 1980 and has a Gini index of 42,6 in 2012, while in the years in between the Gini index went up and down several times.

```{r}
#What countries have the lowest gini indices?
cl <- c("MDG","BDI","MWI","GNB","MOZ","ZMB","LSO")
# subset with only those countries
idmc <- subset(idm,idm$Country.Code %in% cl)
# plot the gini idexes of those countries over time
x <- list( title = "Years" )
y <- list( title = "Gini Index" )
m <- list(l=150, r=20, b=70, t=10)
pline <- plot_ly(idmc, x = ~idmc$variable, y = ~idmc$value, color = ~idmc$Country.Code) %>%
  add_lines(line = list(shape = "spline"))  %>% layout(xaxis = x, yaxis = y, margin=m)
pline
```

#### Plotting the lorenz curve
Below is the code for the lorenzcurve of the countrie with the lowest Gini Index. The lorenzcurve shows the distribution of wealth between the people in a country. Every Lorenzcurve has it own Gini index. The more away the lorenzcurve is from the middle diagonal, the higher the Gini index and the more unfair the wealth is distributed.We can see for example in Losotho that around 70& of the wealth is with only 40% of the people. We can conclude that in the countries with a high prevalence of poverty there is also a high Gini index. This means that for the poor people in those countries the conditions are even more extreme.

```{r}
# PLOT THE LORENZ CURVE OF ONE OF THE COUNTRIES (if a flat line occurs, there is no data)
# Get the indicators for the lorenz curve
my_var = c( "SI.DST.05TH.20","SI.DST.02ND.20","SI.DST.03RD.20", "SI.DST.04TH.20", "SI.DST.FRST.20")
# fill in country code in V1 and run code below
V1 = c("LSO")
# subset the data with only the country and the needed indicators
country_data = subset(indicator_data,indicator_data$Country.Code %in% V1)
COUNTRY_LC_V1 = subset(country_data,country_data$Indicator.Code %in% my_var)
# slice the needed data for the desirable year
COUNTRY_2015 = COUNTRY_LC_V1[,c(1:4,55:55)]
# create a vector for the lorenz curve function
p20 = c(0, 20, 40, 60 , 80,100)
# sort the values of the indicators. Make sure the year is the right one
d20 = sort(COUNTRY_2015$X2010)
# plot the lorenz curve
Lc.c <- Lc(d20, p20)
plot(Lc.c,col="darkred",lwd = 6, main = 'Lorenz Curve for Lesotho in the year 2010',xlab = 'Percentage of the people', ylab = 'percentage of the wealth')

gini_index_country = Gini(d20)

```


### 3.3 
Poverty has a strong relation with various outcomes of the society of a country. Therefore we have explored the data to find variables that are correlated with the prevelance of poverty, and we have plotted them in bubble graphs. These variables shall also be used in our predictive model.

#### Poverty and child mortality
Below is the code for the bubble between poverty and spendings on education. In the graph we can see the relation between poverty and the child mortality under five years old within a country. The size of bubbles represent the percentage of people living in extreme poverty, to highlight that indicator. We can see that there is a positive relation between child moratility and poverty. This means that a country with a high percentage of people living in poverty also have a higher mortality rate of children under the age of five. 

```{r}
#determine size per bubble
slope <- 2.8e-6
df_bubble$size <- sqrt(df_bubble$Poverty * slope)*5000
colors = c('#FF934F','#FFD166','#5FCC8C','#EF6464','#5DCBEF','#8C6ACC','#CC6AAC')

p <- plot_ly(df_bubble, x = ~ChildMort, y = ~Poverty, color = ~Region, size = ~size, colors = colors,
             type = 'scatter', mode = 'markers', sizes = c(min(df_bubble$size), max(df_bubble$size)),
             marker = list(symbol = 'circle', sizemode = 'diameter',
                           line = list(width = 2, color = '#FFFFFF')),
             text = ~paste('Country:', Country.Name,
                           '<br> Region:', Region,
                           '<br> Childmortality under 5 per 1000 births: ', ChildMort,"%",
                           "<br> Percentage of population living in Extreme Poverty: ", Poverty,"%",
                           "<br> Total population living in Extreme Poverty:", TotalPopPov,"M",
                           '<br> Total population:', TotalPop, "M")) %>%
  layout(title = 'Childmortality and the prevalence of Extreme Poverty',
         xaxis = list(title = 'Childmortality under 5 per 1000 births',
                      gridcolor = 'rgb(255, 255, 255)',
                      zerolinewidth = 1,
                      ticklen = 4,
                      gridwidth = 2),
         yaxis = list(title = 'Prevalence of Poverty (%population)',
                      gridcolor = 'rgb(255, 255, 255)',
                      zerolinewidth = 1,
                      ticklen = 5,
                      gridwith = 2),
         paper_bgcolor = 'rgb(243, 243, 243)',
         plot_bgcolor = 'rgb(243, 243, 243)')
p
```

#### Poverty correlates with health outcomes
People who live in extreme poverty have particularly bad health outcomes. Countries with a low life expectancy (by birth), generally have a high prevelance of extreme poverty. As we can see, there is a clear negative relationship: people tend to live longer in countries where poverty is less common. The bubbles are relative for the extreme poverty headcount. Yet the correlation is far from perfect. Some countries such as Madagascar and Congo have a similar poverty headcount but a very different life expectancy. 
The highest difference is between the countries Guinea and Iceland with a difference of (82,92 - 57,78 =) 25 years.

```{r}
#determine size per bubble
slope <- 2.8e-6
df_bubble$size <- sqrt(df_bubble$Poverty * slope)*5000
colors = c('#FF934F','#FFD166','#5FCC8C','#EF6464','#5DCBEF','#8C6ACC','#CC6AAC')
                                            
p <- plot_ly(df_bubble, x = ~LifeExpec, y = ~Poverty, color = ~Region, size = ~size, colors = colors,
             type = 'scatter', mode = 'markers', sizes = c(min(df_bubble$size), max(df_bubble$size)),
             marker = list(symbol = 'circle', sizemode = 'diameter',
                           line = list(width = 2, color = '#FFFFFF')),
             text = ~paste('Country:', Country.Name, '<br> Life expectance by birth', LifeExpec,"years", '<br>Region:', Region,
                           "<br> Percentage of population living in Extreme Poverty", Poverty,"%",
                           "<br> Total population living in Extreme Poverty:", TotalPopPov,"M",
                           '<br> Total population:', TotalPop, "M")) %>%
  layout(title = 'Life Expectancy and Extreme Poverty 2013',
         xaxis = list(title = 'Life expectancy in years (by birth)',
                      gridcolor = 'rgb(255, 255, 255)',
                      zerolinewidth = 1,
                      type = 'log',
                      ticklen = 4,
                      gridwidth = 2),
         yaxis = list(title = 'Prevalence of Poverty (% of population)',
                      gridcolor = 'rgb(255, 255, 255)',
                      zerolinewidth = 1,
                      ticklen = 5,
                      range = c(-15,100),
                      gridwith = 2),
         paper_bgcolor = 'rgb(243, 243, 243)',
         plot_bgcolor = 'rgb(243, 243, 243)')
p

```
c
## 4 Model draft
Here: 
  - Correlation of predictors vs. output X and Y
  - Fitting of distributions --> curve fitting histrograms
  - structure of RJAGS model
  - Calibration of RJAGS model
  - Prediction of Rjags model


## 5 evaluation
- evaluation
Insights gained from the figures and graphs  is useful because they play an important role in assissting policy makers and project implementers by revealing the poverty trend in the world, the potential causes of poverty, and thus helping evaluating the efforts put in targeting poverty alleviation.

The objectives of this report are: (1) to explore the spatial and temporal distribution of poverty and inequality at the regional and national level, (2) to show the strong correlation between children mortality, health outcomes and poverty, (3) to estimate how the level of poverty will be reduced or boosted  based on data in education, mortality at national level.


-	Discuss research findings to quality of the model, quality of the data. 

-	How could the model be improved  suggest next steps

## 6 development
	- Can we predict future behaviour/Guide additional policy
	- How would we communicate our findings to decision makers? 



Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
